C51 COMPILER V9.54   IR                                                                    04/21/2023 20:56:16 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE IR
OBJECT MODULE PLACED IN .\Objects\IR.obj
COMPILER INVOKED BY: D:\Keil5MDK\C51\BIN\C51.EXE IR.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\IR.ls
                    -t) OBJECT(.\Objects\IR.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "Timer0.h"
   3          #include "Int0.h"
   4          
   5          unsigned int IR_Time;//è®¡æ—¶
   6          unsigned char IR_State;
   7          
   8          unsigned char IR_Data[4];
   9          unsigned char IR_pData;
  10          
  11          unsigned char IR_DataFlag;
  12          unsigned char IR_RepeatFlag;
  13          unsigned char IR_Address;
  14          unsigned char IR_Command;
  15          
  16          /**
  17           * @brief  çº¢å¤–é¥æŽ§
  18           * @param  æ— 
  19           * @retval æ— 
  20           */
  21          void IR_Init(void)
  22          {
  23   1          Timer0_Init();
  24   1          Int0_Init();
  25   1      }
  26          
  27          /**
  28           * @brief  çº¢å¤–é¥æŽ§èŽ·å–æŽ¥æ”¶åˆ°çš„æ•°æ®å¸§æ ‡å¿—ä½
  29           * @param  æ— 
  30           * @retval æ˜¯å¦æŽ¥æ”¶åˆ°æ•°æ®å¸§ï¼Œ1ä¸ºæŽ¥æ”¶åˆ°ï¼Œ0ä¸ºæœªæŽ¥æ”¶åˆ°
  31          */
  32          unsigned char IR_GetDataFlag(void)
  33          {
  34   1          if(IR_DataFlag)
  35   1          {
  36   2              IR_DataFlag=0;
  37   2              return 1;
  38   2          }
  39   1          return 0;
  40   1      }
  41          
  42          /**
  43           * @brief  çº¢å¤–é¥æŽ§èŽ·å–æŽ¥æ”¶åˆ°çš„é‡å¤å¸§æ ‡å¿—ä½
  44           * @param  æ— 
  45           * @retval æ˜¯å¦æŽ¥æ”¶åˆ°é‡å¤å¸§ï¼Œ1ä¸ºæŽ¥æ”¶åˆ°ï¼Œ0ä¸ºæœªæŽ¥æ”¶åˆ°
  46          */
  47          unsigned char IR_GetRepeatFlag(void)
  48          {
  49   1          if(IR_RepeatFlag)
  50   1          {
  51   2              IR_RepeatFlag=0;
  52   2              return 1;
  53   2          }
  54   1          return 0;
C51 COMPILER V9.54   IR                                                                    04/21/2023 20:56:16 PAGE 2   

  55   1      }
  56          
  57          /**
  58           * @brief  çº¢å¤–é¥æŽ§èŽ·å–æŽ¥æ”¶åˆ°çš„åœ°å€æ•°æ®
  59           * @param  æ— 
  60           * @retval åœ°å€æ•°æ®
  61          */
  62          unsigned char IR_GetAddress(void)
  63          {
  64   1          return IR_Address;
  65   1      }
  66          
  67          /**
  68           * @brief  çº¢å¤–é¥æŽ§èŽ·å–æŽ¥æ”¶åˆ°çš„å‘½ä»¤æ•°æ®
  69           * @param  æ— 
  70           * @retval å‘½ä»¤æ•°æ®
  71          */
  72          unsigned char IR_GetCommand(void)
  73          {
  74   1          return IR_Command;
  75   1      }
  76          
  77          //çº¢å¤–é¥æŽ§ä¸­æ–­æœåŠ¡å‡½æ•°ï¼Œä¸‹é™æ²¿è§¦å‘æ‰§è¡Œ
  78          void Int0_Routine(void) interrupt 0
  79          {
  80   1              if(IR_State==0)
  81   1          {
  82   2              Timer0_SetCounter(0);
  83   2              Timer0_Run(1);
  84   2              IR_State=1;
  85   2          }
  86   1          else if(IR_State==1)
  87   1          {
  88   2              IR_Time=Timer0_GetCounter();    //èŽ·å–ä¸Šä¸€æ¬¡ä¸­æ–­åˆ°æ­¤æ¬¡ä¸­æ–­çš„æ—¶é—´
  89   2              Timer0_SetCounter(0);           //æ¸…é›¶è®¡æ•°å™¨
  90   2              //å¦‚æžœè®¡æ—¶ä¸º13.5msï¼Œè¯´æ˜Žæ˜¯èµ·å§‹ä¿¡å·ï¼ˆåˆ¤å®šå€¼åœ¨12MHzæ™¶æŒ¯ä¸‹ä¸º13500ï¼Œåœ¨11.0592M
             -Hzæ™¶æŒ¯ä¸‹ä¸º12442ï¼‰
  91   2              if(IR_Time>12442-500 && IR_Time<12442+500)
  92   2              {
  93   3                  IR_State=2;                 //ç½®çŠ¶æ€ä¸º2ï¼Œè¿›å…¥æ•°æ®æŽ¥æ”¶çŠ¶æ€ã€‚
  94   3              }
  95   2              //å¦‚æžœè®¡æ—¶ä¸º11.25msï¼Œè¯´æ˜Žæ˜¯é‡å¤ä¿¡å·ï¼ˆåˆ¤å®šå€¼åœ¨12MHzæ™¶æŒ¯ä¸‹ä¸º11250ï¼Œåœ¨11.0592
             -MHzæ™¶æŒ¯ä¸‹ä¸º10368ï¼‰
  96   2              else if(IR_Time>10368-500 && IR_Time<10368+500)
  97   2              {
  98   3                  IR_RepeatFlag=1;            //ç½®é‡å¤å¸§æ ‡å¿—ä½ä¸º1
  99   3                  Timer0_Run(0);              //å®šæ—¶å™¨åœæ­¢
 100   3                  IR_State=0;                 //ç½®çŠ¶æ€ä¸º0ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚
 101   3              }
 102   2              else                            //æŽ¥æ”¶å‡ºé”™
 103   2              {
 104   3                  IR_State=1;                 //ç½®çŠ¶æ€ä¸º1ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚
 105   3              }
 106   2          }
 107   1          else if(IR_State==2)                //çŠ¶æ€2ï¼ŒæŽ¥æ”¶æ•°æ®
 108   1          {
 109   2              IR_Time=Timer0_GetCounter();    //èŽ·å–ä¸Šä¸€æ¬¡ä¸­æ–­åˆ°æ­¤æ¬¡ä¸­æ–­çš„æ—¶é—´
 110   2              Timer0_SetCounter(0);           //å®šæ—¶è®¡æ•°å™¨æ¸…é›¶
 111   2              //å¦‚æžœè®¡æ—¶ä¸º1120usï¼Œè¯´æ˜Žæ˜¯0ï¼ˆåˆ¤å®šå€¼åœ¨12MHzæ™¶æŒ¯ä¸‹ä¸º1120ï¼Œåœ¨11.0592MHzæ™¶æŒ¯ä¸‹ä
             -¸º1032ï¼‰
 112   2              if(IR_Time>=1032-500 && IR_Time<1032+500)
 113   2              {
C51 COMPILER V9.54   IR                                                                    04/21/2023 20:56:16 PAGE 3   

 114   3                  IR_Data[IR_pData/8]&=~(0x01<<(IR_pData%8));//æ•°æ®ä½å¯¹åº”çš„å­—èŠ‚æ¸…é›¶
 115   3                  IR_pData++;                 //æ•°æ®ä½æŒ‡é’ˆè‡ªå¢ž
 116   3              }
 117   2              //å¦‚æžœè®¡æ—¶ä¸º2250usï¼Œè¯´æ˜Žæ˜¯1ï¼ˆåˆ¤å®šå€¼åœ¨12MHzæ™¶æŒ¯ä¸‹ä¸º2250ï¼Œåœ¨11.0592MHzæ™¶æŒ¯ä¸‹ä
             -¸º2074ï¼‰
 118   2              else if(IR_Time>=2074-500 && IR_Time<2074+500)
 119   2              {
 120   3                  IR_Data[IR_pData/8]|=(0x01<<(IR_pData%8));//æ•°æ®ä½å¯¹åº”ä½ç½®1
 121   3                  IR_pData++;                 //æ•°æ®ä½æŒ‡é’ˆè‡ªå¢ž
 122   3              }
 123   2              else                            //æŽ¥æ”¶å‡ºé”™
 124   2              {
 125   3                  IR_pData=0;                 //æ•°æ®ä½æŒ‡é’ˆæ¸…é›¶
 126   3                  IR_State=1;                 //ç½®çŠ¶æ€ä¸º1ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚
 127   3              }
 128   2              if(IR_pData>=32)
 129   2              {
 130   3                  IR_pData=0;
 131   3                  if((IR_Data[0]==~IR_Data[1]) && (IR_Data[2]==~IR_Data[3]))
 132   3                  {
 133   4                      IR_Address=IR_Data[0];
 134   4                      IR_Command=IR_Data[2];
 135   4                      IR_DataFlag=1;
 136   4                  }
 137   3                  Timer0_Run(0);
 138   3                  IR_State=0;
 139   3              }
 140   2          }
 141   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    370    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     12    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
